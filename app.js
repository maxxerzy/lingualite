const STORAGE_KEY='lingualite_state_v29'; const ELO_KEY='lingualite_elo_v29';
let decks=null,currentDeck=null,currentMode='flashcards';let sessionQueue=[];let currentCard=null;let score=0,wrongStreak=0;
const DEFAULT_ELO=1200,K=16;
document.addEventListener('DOMContentLoaded',()=>{fetch('decks.json').then(r=>r.json()).then(data=>{decks=data.decks;renderDecks();});document.getElementById('startBtn').onclick=startLearning;});
function renderDecks(){const cont=document.getElementById('deckList');cont.textContent='';decks.forEach((d,i)=>{const el=document.createElement('div');el.className='card';el.textContent=d.name+' ('+d.cards.length+' Karten)';el.onclick=()=>{currentDeck=d;document.getElementById('learnBtn').classList.remove('hidden');};cont.appendChild(el);});}
function showSection(id){document.querySelectorAll('.section').forEach(s=>s.classList.add('hidden'));document.getElementById(id).classList.remove('hidden');}
function startLearning(){currentMode=document.getElementById('modeSelect').value;score=0;wrongStreak=0;sessionQueue=[...currentDeck.cards];shuffle(sessionQueue);nextCard();}
function nextCard(){const area=document.getElementById('learningArea');area.textContent='';if(sessionQueue.length===0){area.textContent='Fertig! Punkte: '+score;return;}currentCard=sessionQueue.shift();const card=document.createElement('div');card.className='card';card.textContent=currentCard.front;area.appendChild(card);const btn=document.createElement('button');btn.textContent='Antwort zeigen';btn.onclick=()=>{const fb=document.createElement('div');fb.textContent='Richtig: '+currentCard.back;area.appendChild(fb);const b1=document.createElement('button');b1.textContent='Richtig';b1.onclick=()=>{score++;sessionQueue.push(currentCard);nextCard();};const b2=document.createElement('button');b2.textContent='Falsch';b2.onclick=()=>{wrongStreak++;if(wrongStreak>=2){score=Math.max(0,score-1);wrongStreak=0;}sessionQueue.splice(2,0,currentCard);nextCard();};area.appendChild(b1);area.appendChild(b2);};area.appendChild(btn);}function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}function resetAll(){localStorage.clear();location.reload();}function exportDecks(){const blob=new Blob([JSON.stringify(decks)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='decks.json';a.click();}